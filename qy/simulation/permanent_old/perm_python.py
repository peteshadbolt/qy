import numpy as np

def perm_ryser(a):
    ''' the permanent calculated using the ryser formula. much faster than the naive approach '''
    n,n2=a.shape
    z=np.arange(n)
    irange=xrange(2**n)
    get_index=lambda i: (i & (1 << z)) != 0 
    get_term=lambda index: ((-1)**np.sum(index))*np.prod(np.sum(a[index,:], 0))
    indeces=map(get_index, irange)
    terms=map(get_term, indeces) 
    return np.sum(terms)*((-1)**n)

def perm_2x2(a):
    ''' an explicit 2x2 permanent '''
    return a[0,0]*a[1,1] \
         + a[1,0]*a[0,1]

def perm_3x3(a):
    ''' an explicit 3x3 permanent '''
    return a[0,0]*a[1,1]*a[2,2] \
         + a[0,0]*a[2,1]*a[1,2] \
         + a[1,0]*a[0,1]*a[2,2] \
         + a[1,0]*a[2,1]*a[0,2] \
         + a[2,0]*a[0,1]*a[1,2] \
         + a[2,0]*a[1,1]*a[0,2]

def perm_4x4(a):
    ''' an explicit 4x4 permanent '''
    return a[0,0]*a[1,1]*a[2,2]*a[3,3] \
         + a[0,0]*a[1,1]*a[3,2]*a[2,3] \
         + a[0,0]*a[2,1]*a[1,2]*a[3,3] \
         + a[0,0]*a[2,1]*a[3,2]*a[1,3] \
         + a[0,0]*a[3,1]*a[1,2]*a[2,3] \
         + a[0,0]*a[3,1]*a[2,2]*a[1,3] \
         + a[1,0]*a[0,1]*a[2,2]*a[3,3] \
         + a[1,0]*a[0,1]*a[3,2]*a[2,3] \
         + a[1,0]*a[2,1]*a[0,2]*a[3,3] \
         + a[1,0]*a[2,1]*a[3,2]*a[0,3] \
         + a[1,0]*a[3,1]*a[0,2]*a[2,3] \
         + a[1,0]*a[3,1]*a[2,2]*a[0,3] \
         + a[2,0]*a[0,1]*a[1,2]*a[3,3] \
         + a[2,0]*a[0,1]*a[3,2]*a[1,3] \
         + a[2,0]*a[1,1]*a[0,2]*a[3,3] \
         + a[2,0]*a[1,1]*a[3,2]*a[0,3] \
         + a[2,0]*a[3,1]*a[0,2]*a[1,3] \
         + a[2,0]*a[3,1]*a[1,2]*a[0,3] \
         + a[3,0]*a[0,1]*a[1,2]*a[2,3] \
         + a[3,0]*a[0,1]*a[2,2]*a[1,3] \
         + a[3,0]*a[1,1]*a[0,2]*a[2,3] \
         + a[3,0]*a[1,1]*a[2,2]*a[0,3] \
         + a[3,0]*a[2,1]*a[0,2]*a[1,3] \
         + a[3,0]*a[2,1]*a[1,2]*a[0,3]

def perm_5x5(a):
    ''' an explicit 5x5 permanent '''
    return a[0,0]*a[1,1]*a[2,2]*a[3,3]*a[4,4] \
         + a[0,0]*a[1,1]*a[2,2]*a[4,3]*a[3,4] \
         + a[0,0]*a[1,1]*a[3,2]*a[2,3]*a[4,4] \
         + a[0,0]*a[1,1]*a[3,2]*a[4,3]*a[2,4] \
         + a[0,0]*a[1,1]*a[4,2]*a[2,3]*a[3,4] \
         + a[0,0]*a[1,1]*a[4,2]*a[3,3]*a[2,4] \
         + a[0,0]*a[2,1]*a[1,2]*a[3,3]*a[4,4] \
         + a[0,0]*a[2,1]*a[1,2]*a[4,3]*a[3,4] \
         + a[0,0]*a[2,1]*a[3,2]*a[1,3]*a[4,4] \
         + a[0,0]*a[2,1]*a[3,2]*a[4,3]*a[1,4] \
         + a[0,0]*a[2,1]*a[4,2]*a[1,3]*a[3,4] \
         + a[0,0]*a[2,1]*a[4,2]*a[3,3]*a[1,4] \
         + a[0,0]*a[3,1]*a[1,2]*a[2,3]*a[4,4] \
         + a[0,0]*a[3,1]*a[1,2]*a[4,3]*a[2,4] \
         + a[0,0]*a[3,1]*a[2,2]*a[1,3]*a[4,4] \
         + a[0,0]*a[3,1]*a[2,2]*a[4,3]*a[1,4] \
         + a[0,0]*a[3,1]*a[4,2]*a[1,3]*a[2,4] \
         + a[0,0]*a[3,1]*a[4,2]*a[2,3]*a[1,4] \
         + a[0,0]*a[4,1]*a[1,2]*a[2,3]*a[3,4] \
         + a[0,0]*a[4,1]*a[1,2]*a[3,3]*a[2,4] \
         + a[0,0]*a[4,1]*a[2,2]*a[1,3]*a[3,4] \
         + a[0,0]*a[4,1]*a[2,2]*a[3,3]*a[1,4] \
         + a[0,0]*a[4,1]*a[3,2]*a[1,3]*a[2,4] \
         + a[0,0]*a[4,1]*a[3,2]*a[2,3]*a[1,4] \
         + a[1,0]*a[0,1]*a[2,2]*a[3,3]*a[4,4] \
         + a[1,0]*a[0,1]*a[2,2]*a[4,3]*a[3,4] \
         + a[1,0]*a[0,1]*a[3,2]*a[2,3]*a[4,4] \
         + a[1,0]*a[0,1]*a[3,2]*a[4,3]*a[2,4] \
         + a[1,0]*a[0,1]*a[4,2]*a[2,3]*a[3,4] \
         + a[1,0]*a[0,1]*a[4,2]*a[3,3]*a[2,4] \
         + a[1,0]*a[2,1]*a[0,2]*a[3,3]*a[4,4] \
         + a[1,0]*a[2,1]*a[0,2]*a[4,3]*a[3,4] \
         + a[1,0]*a[2,1]*a[3,2]*a[0,3]*a[4,4] \
         + a[1,0]*a[2,1]*a[3,2]*a[4,3]*a[0,4] \
         + a[1,0]*a[2,1]*a[4,2]*a[0,3]*a[3,4] \
         + a[1,0]*a[2,1]*a[4,2]*a[3,3]*a[0,4] \
         + a[1,0]*a[3,1]*a[0,2]*a[2,3]*a[4,4] \
         + a[1,0]*a[3,1]*a[0,2]*a[4,3]*a[2,4] \
         + a[1,0]*a[3,1]*a[2,2]*a[0,3]*a[4,4] \
         + a[1,0]*a[3,1]*a[2,2]*a[4,3]*a[0,4] \
         + a[1,0]*a[3,1]*a[4,2]*a[0,3]*a[2,4] \
         + a[1,0]*a[3,1]*a[4,2]*a[2,3]*a[0,4] \
         + a[1,0]*a[4,1]*a[0,2]*a[2,3]*a[3,4] \
         + a[1,0]*a[4,1]*a[0,2]*a[3,3]*a[2,4] \
         + a[1,0]*a[4,1]*a[2,2]*a[0,3]*a[3,4] \
         + a[1,0]*a[4,1]*a[2,2]*a[3,3]*a[0,4] \
         + a[1,0]*a[4,1]*a[3,2]*a[0,3]*a[2,4] \
         + a[1,0]*a[4,1]*a[3,2]*a[2,3]*a[0,4] \
         + a[2,0]*a[0,1]*a[1,2]*a[3,3]*a[4,4] \
         + a[2,0]*a[0,1]*a[1,2]*a[4,3]*a[3,4] \
         + a[2,0]*a[0,1]*a[3,2]*a[1,3]*a[4,4] \
         + a[2,0]*a[0,1]*a[3,2]*a[4,3]*a[1,4] \
         + a[2,0]*a[0,1]*a[4,2]*a[1,3]*a[3,4] \
         + a[2,0]*a[0,1]*a[4,2]*a[3,3]*a[1,4] \
         + a[2,0]*a[1,1]*a[0,2]*a[3,3]*a[4,4] \
         + a[2,0]*a[1,1]*a[0,2]*a[4,3]*a[3,4] \
         + a[2,0]*a[1,1]*a[3,2]*a[0,3]*a[4,4] \
         + a[2,0]*a[1,1]*a[3,2]*a[4,3]*a[0,4] \
         + a[2,0]*a[1,1]*a[4,2]*a[0,3]*a[3,4] \
         + a[2,0]*a[1,1]*a[4,2]*a[3,3]*a[0,4] \
         + a[2,0]*a[3,1]*a[0,2]*a[1,3]*a[4,4] \
         + a[2,0]*a[3,1]*a[0,2]*a[4,3]*a[1,4] \
         + a[2,0]*a[3,1]*a[1,2]*a[0,3]*a[4,4] \
         + a[2,0]*a[3,1]*a[1,2]*a[4,3]*a[0,4] \
         + a[2,0]*a[3,1]*a[4,2]*a[0,3]*a[1,4] \
         + a[2,0]*a[3,1]*a[4,2]*a[1,3]*a[0,4] \
         + a[2,0]*a[4,1]*a[0,2]*a[1,3]*a[3,4] \
         + a[2,0]*a[4,1]*a[0,2]*a[3,3]*a[1,4] \
         + a[2,0]*a[4,1]*a[1,2]*a[0,3]*a[3,4] \
         + a[2,0]*a[4,1]*a[1,2]*a[3,3]*a[0,4] \
         + a[2,0]*a[4,1]*a[3,2]*a[0,3]*a[1,4] \
         + a[2,0]*a[4,1]*a[3,2]*a[1,3]*a[0,4] \
         + a[3,0]*a[0,1]*a[1,2]*a[2,3]*a[4,4] \
         + a[3,0]*a[0,1]*a[1,2]*a[4,3]*a[2,4] \
         + a[3,0]*a[0,1]*a[2,2]*a[1,3]*a[4,4] \
         + a[3,0]*a[0,1]*a[2,2]*a[4,3]*a[1,4] \
         + a[3,0]*a[0,1]*a[4,2]*a[1,3]*a[2,4] \
         + a[3,0]*a[0,1]*a[4,2]*a[2,3]*a[1,4] \
         + a[3,0]*a[1,1]*a[0,2]*a[2,3]*a[4,4] \
         + a[3,0]*a[1,1]*a[0,2]*a[4,3]*a[2,4] \
         + a[3,0]*a[1,1]*a[2,2]*a[0,3]*a[4,4] \
         + a[3,0]*a[1,1]*a[2,2]*a[4,3]*a[0,4] \
         + a[3,0]*a[1,1]*a[4,2]*a[0,3]*a[2,4] \
         + a[3,0]*a[1,1]*a[4,2]*a[2,3]*a[0,4] \
         + a[3,0]*a[2,1]*a[0,2]*a[1,3]*a[4,4] \
         + a[3,0]*a[2,1]*a[0,2]*a[4,3]*a[1,4] \
         + a[3,0]*a[2,1]*a[1,2]*a[0,3]*a[4,4] \
         + a[3,0]*a[2,1]*a[1,2]*a[4,3]*a[0,4] \
         + a[3,0]*a[2,1]*a[4,2]*a[0,3]*a[1,4] \
         + a[3,0]*a[2,1]*a[4,2]*a[1,3]*a[0,4] \
         + a[3,0]*a[4,1]*a[0,2]*a[1,3]*a[2,4] \
         + a[3,0]*a[4,1]*a[0,2]*a[2,3]*a[1,4] \
         + a[3,0]*a[4,1]*a[1,2]*a[0,3]*a[2,4] \
         + a[3,0]*a[4,1]*a[1,2]*a[2,3]*a[0,4] \
         + a[3,0]*a[4,1]*a[2,2]*a[0,3]*a[1,4] \
         + a[3,0]*a[4,1]*a[2,2]*a[1,3]*a[0,4] \
         + a[4,0]*a[0,1]*a[1,2]*a[2,3]*a[3,4] \
         + a[4,0]*a[0,1]*a[1,2]*a[3,3]*a[2,4] \
         + a[4,0]*a[0,1]*a[2,2]*a[1,3]*a[3,4] \
         + a[4,0]*a[0,1]*a[2,2]*a[3,3]*a[1,4] \
         + a[4,0]*a[0,1]*a[3,2]*a[1,3]*a[2,4] \
         + a[4,0]*a[0,1]*a[3,2]*a[2,3]*a[1,4] \
         + a[4,0]*a[1,1]*a[0,2]*a[2,3]*a[3,4] \
         + a[4,0]*a[1,1]*a[0,2]*a[3,3]*a[2,4] \
         + a[4,0]*a[1,1]*a[2,2]*a[0,3]*a[3,4] \
         + a[4,0]*a[1,1]*a[2,2]*a[3,3]*a[0,4] \
         + a[4,0]*a[1,1]*a[3,2]*a[0,3]*a[2,4] \
         + a[4,0]*a[1,1]*a[3,2]*a[2,3]*a[0,4] \
         + a[4,0]*a[2,1]*a[0,2]*a[1,3]*a[3,4] \
         + a[4,0]*a[2,1]*a[0,2]*a[3,3]*a[1,4] \
         + a[4,0]*a[2,1]*a[1,2]*a[0,3]*a[3,4] \
         + a[4,0]*a[2,1]*a[1,2]*a[3,3]*a[0,4] \
         + a[4,0]*a[2,1]*a[3,2]*a[0,3]*a[1,4] \
         + a[4,0]*a[2,1]*a[3,2]*a[1,3]*a[0,4] \
         + a[4,0]*a[3,1]*a[0,2]*a[1,3]*a[2,4] \
         + a[4,0]*a[3,1]*a[0,2]*a[2,3]*a[1,4] \
         + a[4,0]*a[3,1]*a[1,2]*a[0,3]*a[2,4] \
         + a[4,0]*a[3,1]*a[1,2]*a[2,3]*a[0,4] \
         + a[4,0]*a[3,1]*a[2,2]*a[0,3]*a[1,4] \
         + a[4,0]*a[3,1]*a[2,2]*a[1,3]*a[0,4]


